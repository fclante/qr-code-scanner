<h1>Medarbejder - Scan</h1>

<div class="scanner-container">
    <div id="reader"></div>
    <button id="scanButton" class="btn btn-primary mt-3">Scan QR Code</button>
</div>

<div id="result-card" class="card mt-4" style="display: none;">
    <div class="card-header">
        Scan Results
    </div>
    <div class="card-body">
        <p id="scan-result">No data yet</p>
    </div>
</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
    const html5QrCode = new Html5Qrcode("reader");
    const resultCard = document.getElementById('result-card');
    const scanResult = document.getElementById('scan-result');
    
    document.getElementById('scanButton').addEventListener('click', () => {
        html5QrCode.start(
            { facingMode: "environment" },
            {
                fps: 10,
                qrbox: 250
            },
            (decodedText) => {
                // Success callback
                try {
                    const scannedData = JSON.parse(decodedText);
                    // Redirect to the scan route with the item ID
                    window.location.href = `/scan/${scannedData.id}`;
                } catch (error) {
                    console.error('Invalid QR code data:', error);
                    resultCard.style.display = 'block';
                    scanResult.textContent = 'Invalid QR code format';
                }
                html5QrCode.stop();
            },
            (error) => {
                // Error callback
                console.error(error);
            }
        );
    });
</script>
